<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>simpleRenderQueue</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="lib/CSInterface.js"></script>
    <script type="text/javascript" type="module">
        const processRequest = () =>{
            const functionParam = {
                type: document.getElementById('typeOfRenderingQueue').value,
                applyFor: document.getElementById('rangeOfRenderingQueue').value,
                searchPattern: document.getElementById('searchedValue').value == "" ? null : document.getElementById('searchedValue').value,
                encodingPreset: document.getElementById('encodingPreset').value == "" ? null : document.getElementById('encodingPreset').value, 
                customEncodingPresetPath: document.getElementById('customEncodingPresetPath').value == "" ? null : document.getElementById('customEncodingPresetPath').value,
                outputPath: document.getElementById('newOutputPath').value == "" ? null : document.getElementById('newOutputPath').value,
                folderName: document.getElementById('newFolderName').value == "" ? null :  document.getElementById('newFolderName').value, 
                filesName: document.getElementById('newNamePattern').value == "" ? null : document.getElementById('newNamePattern').value,
            }
            let cs = new CSInterface;
                cs.evalScript(`$.runScript.processRequest('${JSON.stringify(functionParam)}')`);
        }
        const patternFieldUnlock = (event) =>{
            const selector = document.getElementById("searchedValue");
            if(event.target.value == "Current_sequence"){
                selector.disabled = true;
            } else {
                selector.disabled = false;
            }
        }
        const presetPathUnlock = (event) => {
            const field = document.getElementById("customEncodingPresetPath");
            if(event.target.value == "custom"){
                field.disabled = false;
            } else {
                field.disabled = true;   
            }
        }
        const isConditionFullfiled = (event) =>{
            if(event.target.value != "" && event.target.value != null && event.target.value != undefined){
                const submit = document.getElementById('runButton');
                      submit.addEventListener('click',processRequest);
                      submit.disabled = false;
            }
        } 
        async function getDir() {
            const dirHandle = await window.showDirectoryPicker();

        }
        const attachBodyScripts = () =>{
        const outputPathField = document.getElementById("newOutputPath");
              outputPathField.addEventListener('keyup',isConditionFullfiled);
            //outputPathField.addEventListener('click',getDir);
        const applyForSelector = document.getElementById("rangeOfRenderingQueue");
              applyForSelector.addEventListener('change',patternFieldUnlock)

        const customPresetSelector = document.getElementById("encodingPreset");
              customPresetSelector.addEventListener('change',presetPathUnlock);     
        }

        addEventListener('contextmenu',e=>e.preventDefault());
        addEventListener('load',attachBodyScripts);
    </script>
</head>

<body>

    <div id="mainContainer">

        <h3 id="mainTitle">RenderQueueTool</h3>
        <div class="elementContainer">
            <label for="typeOfRenderingQueue">Render type: </label>
            <select id="typeOfRenderingQueue">
                <option>clips</option>
                <option>Sequences</option>
            </select>
        </div>
        
        <div class="elementContainer">
            <label for="rangeOfRenderingQueue"> Apply for: </label>
            <select id="rangeOfRenderingQueue">
                <option>Current_sequence</option>
                <option>Multiple_sequences</option>
            </select>
        </div>

        <div class="elementContainer">
            <label for="searchedValue">Search sequence pattern</label>
            <input type='text' id="searchedValue" placeholder="choose sequences" disabled> 
        </div>
        
        <div class="elementContainer">
            <label>Select encoding preset</label>
            <select id="encodingPreset">
                <option>h.264 | .mp4</option>
                <option>vp9 | .webm</option>
                <option>custom</option>
            </select>
            <input type="text" id="customEncodingPresetPath" placeholder="custom preset path" disabled>
        </div>

        <div class="elementContainer">
            <label for="newOutputPath">Output Details</label>
            <input type="text" id="newOutputPath" placeholder="set output path*">
            <input type="text" id="newFolderName" placeholder="new folder name">
            <input type="text" id="newNamePattern" placeholder="set files name pattern">
        </div>
        
        <div class="elementContainer">
            <button id="runButton" type="run" disabled>Add to queue</button>
        </div> 

    </div>

</body>
</html>